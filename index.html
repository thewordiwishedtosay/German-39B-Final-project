<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Midnight Archive // ROOT_ACCESS</title>
    <style>
        /* --- 1. CORE AESTHETICS (Shared) --- */
        :root {
            --bg-color: #050505;
            --forum-bg: #1a1a1a;
            --header-bg: #000080; /* Classic Blue Screen Blue */
            --text-main: #cccccc;
            --text-dim: #777777;
            --link-color: #ff3333;
            --border-color: #444;
            --terminal-green: #00ff00;

            /* Fix: define --text-color (map to --text-main) so body color resolves */
            --text-color: var(--text-main);
        }

        body {
            background-color: #000; /* Fallback color */
            
            /* USE THE NEW SHORT NAME HERE */
            background-image: url('back.jpg'); 
            
            /* This makes it repeat like tiles */
            background-repeat: repeat;
	    background-attachment: fixed;
	    background-position: center center;
            
            /* Keep one sensible background-size */
            background-size: 300px; 

            /* Darken it slightly so text is readable */
            box-shadow: inset 0 0 0 2000px rgba(0, 0, 0, 0.6);
            
            /* Keep text styles */
            color: var(--text-color);
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 40px;
            overflow-x: hidden;
            min-height: 100vh; /* Ensures background fills screen */
        }

        /* --- 2. LAYOUT & CONTAINERS --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            border: 2px solid var(--border-color);
            background-color: var(--forum-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        /* --- 3. PORTAL (LANDING PAGE) STYLES --- */
        #portal-view {
            text-align: center;
            padding: 50px 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .portal-title {
            font-family: 'Courier New', monospace;
            font-size: 3rem;
            color: var(--terminal-green);
            text-shadow: 0 0 10px var(--terminal-green);
            margin-bottom: 10px;
            letter-spacing: 5px;
        }

        .portal-subtitle {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 50px;
            border-bottom: 1px dashed #333;
            padding-bottom: 20px;
            width: 80%;
        }

        .gateway-btn {
            display: block;
            width: 80%;
            max-width: 400px;
            margin: 20px 0;
            padding: 20px;
            background: #111;
            border: 2px solid #333;
            color: #aaa;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .gateway-btn:hover {
            border-color: #fff;
            color: #fff;
            text-shadow: 0 0 5px #fff;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }

        .gateway-btn::before {
            content: ">> ";
            color: var(--link-color);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gateway-btn:hover::before {
            opacity: 1;
        }

        /* --- 4. HEADER & NAV (Shared) --- */
        .header {
            background-color: var(--header-bg);
            padding: 10px;
            border-bottom: 3px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 24px;
            color: #fff;
            text-shadow: 2px 2px #ff0000;
            cursor: pointer;
            position: relative;
        }

        .nav-bar {
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            font-size: 11px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 15px;
        }
        
        .nav-link { color: #fff; text-decoration: none; cursor: pointer; }
        .nav-link:hover { text-decoration: underline; color: var(--terminal-green); }

        /* --- 5. POST STYLES (Shared) --- */
        .thread-view {
            display: none; /* Hidden by default */
            flex-direction: column;
            flex-grow: 1;
        }

        .post {
            display: flex;
            border-bottom: 4px solid #000;
            min-height: 200px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-sidebar {
            width: 180px;
            background-color: #222;
            padding: 15px;
            border-right: 1px solid var(--border-color);
            text-align: center;
            font-size: 11px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .avatar {
            width: 100px;
            height: 100px;
            background-color: #000;
            margin-bottom: 10px;
            border: 2px inset #555;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            font-family: monospace;
            overflow: hidden;
            position: relative;
        }

        .username { color: #fff; font-weight: bold; display: block; margin-bottom: 5px; font-size: 13px; }
        .user-title { color: var(--terminal-green); margin-bottom: 15px; display: block; }

        .post-content {
            flex-grow: 1;
            background-color: #2b2b2b;
            display: flex;
            flex-direction: column;
        }

        .post-header {
            background-color: #3a3a3a;
            padding: 5px 15px;
            font-size: 10px;
            color: #aaa;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
        }

        .post-body {
            padding: 20px;
            font-size: 14px;
            line-height: 1.6;
            color: #ddd;
            font-family: 'Verdana', sans-serif;
            white-space: pre-wrap;
        }

        .post-footer {
            margin-top: auto;
            padding: 15px;
            border-top: 1px dashed #555;
            font-style: italic;
            color: #666;
            font-size: 11px;
        }

        /* --- 6. GLITCH & SCARY EFFECTS (Restored from Forum Page) --- */
        
        /* Full Screen Glitch Overlay */
        #screen-glitch {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: black;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            color: red;
            pointer-events: none;
        }

        @keyframes violent-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* ADD THIS KEYFRAME DEFINITION */
        @keyframes glitch-anim {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .cursed-text {
            color: #ff0000;
            text-shadow: 2px 0 blue, -2px 0 green;
            animation: violent-shake 0.5s infinite;
            display: inline-block;
        }

        .avatar-glitch {
            background-image: repeating-linear-gradient(
                45deg,
                #000 0px,
                #222 5px,
                #000 10px
            );
            border-color: red !important;
            color: red !important;
            /* ADD THIS LINE */
            animation: glitch-anim 0.1s infinite;
        }

        /* Control Panel for Generator */
        .control-panel {
            background: #222;
            padding: 15px;
            border-top: 2px solid #555;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .btn-glitch {
            background: #000;
            border: 2px solid var(--terminal-green);
            color: var(--terminal-green);
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
        }
        .btn-glitch:hover { background: var(--terminal-green); color: #000; box-shadow: 0 0 15px var(--terminal-green); }

        /* Pagination for Reader */
        .pagination-container {
            background-color: #222;
            padding: 10px;
            text-align: right;
            border-top: 2px solid #555;
            font-family: monospace;
            font-size: 12px;
        }
        .page-btn { background: none; border: none; color: #888; cursor: pointer; margin: 0 2px; font-family: inherit; }
        .page-btn:hover { color: #fff; text-decoration: underline; }
        .page-active { color: var(--terminal-green); font-weight: bold; }
        .page-disabled { color: #444; cursor: default; }

    </style>
</head>
<body>

<div id="screen-glitch">SYSTEM FAILURE // UNABLE TO LOAD SOUL</div>

<div class="container">
    
    <!-- HEADER -->
    <div class="header">
        <div class="logo" id="main-logo" onclick="showPortal()">MIDNIGHT_ARCHIVE_HUB</div>
        <div style="font-size: 10px; color: #aaa;">SERVER STATUS: <span style="color:red; text-decoration: blink;">CONNECTED</span></div>
    </div>
    
    <!-- NAVIGATION -->
    <div class="nav-bar">
        <span class="nav-link" onclick="showPortal()">[ ROOT_DIRECTORY ]</span>
        <span class="nav-link" onclick="loadCreepypastaMode()">> READ_LOGS</span>
        <span class="nav-link" onclick="loadAppalachianMode()">> HEAR_WARNINGS</span>
    </div>

    <!-- 1. PORTAL VIEW (Landing Page) -->
    <div id="portal-view">
        <div class="portal-title">WELCOME_USER</div>
        <div class="portal-subtitle">SELECT_DATA_STREAM</div>

        <button class="gateway-btn" onclick="loadCreepypastaMode()">
            Enjoy Your Pasta
            <div style="font-size: 10px; color: #666; margin-top: 5px;">[ ARCHIVED STORIES // GPT-2 ]</div>
        </button>

        <button class="gateway-btn" onclick="loadAppalachianMode()">
            Enter the Appalachian Mountains
            <div style="font-size: 10px; color: #666; margin-top: 5px;">[ POETRY // MARKOV CHAINS]</div>
        </button>
    </div>

    <!-- 2. CREEPYPASTA READER VIEW -->
    <div id="creepypasta-view" class="thread-view">
        <div style="background: #444; color: white; padding: 5px 10px; font-size: 12px; font-weight: bold; display: flex; justify-content: space-between; border-bottom: 1px solid #555;">
            <span id="thread-title">Thread: "Found these text files on an old hard drive..."</span>
            <span id="cp-page-indicator">Page 1</span>
        </div>
        
        <div id="cp-posts-container">
            <!-- Posts injected via JS -->
        </div>

        <div class="pagination-container" id="cp-pagination">
            <!-- Controls injected via JS -->
        </div>
    </div>

    <!-- 3. APPALACHIAN GENERATOR VIEW (Markov) -->
    <div id="appalachian-view" class="thread-view">
        <div style="background: #444; color: white; padding: 5px 10px; font-size: 12px; font-weight: bold; display: flex; justify-content: space-between; border-bottom: 1px solid #555;">
            <span>Thread: "The_Old_Laws.txt"</span>
            <span id="gen-post-count">Posts: 0</span>
        </div>

        <div id="gen-posts-container">
            <!-- No static intro posts anymore -->
        </div>

        <div class="control-panel">
            <div style="font-family: monospace; color: #555; font-size: 11px;">
                > ₮ⱧɆ_ØⱠĐ_Ⱡ₳₩₴.₮Ӿ₮
            </div>
            <button class="btn-glitch" onclick="generateNewMarkovPost()">[ Listen to the mountains ]</button>
        </div>
    </div>

    <div style="text-align: center; padding: 20px; font-size: 10px; color: #555; margin-top: auto;">
        Powered by GhostBoard v1.1.2 <br>
        Copyright © 1999-2005
    </div>
</div>

<script>
    // ==========================================
    // DATA: FULL CREEPYPASTA STORIES
    // ==========================================
    const cpStories = [
        {
            user: "PaleWalker_99", title: "Senior Member", date: "Oct 31, 2004, 11:11 PM",
            text: `I found a door in my basement that wasn't there before. It was small, painted red, and warm to the touch. I got rid of everything except the key, and started digging through the dir[...]`
        },
        {
            user: "VHS_Lover", title: "Junior Member", date: "Nov 02, 2004, 03:33 AM",
            text: `The old VHS tape was labeled 'Family Vacation 1999', but when I played it, the people on screen were exactly the same as when it was last played—kids at a playground, and so on. I[...]`
        },
        {
            user: "Dr_Trenton", title: "Banned", date: "ERROR: DATE_CORRUPT",
            text: `It started with a scratching sound inside the walls. At first I thought it was rats, but then I heard the thump as something hit the ceiling. As my eyes adjusted to the darkness and[...]`
        },
        {
            user: "MirrorGazer", title: "New Member", date: "Nov 05, 2004, 01:00 AM",
            text: `I work the night shift at the morgue, and the bodies are supposed to stay still. But tonight, drawer 4B’s shelves were empty. There was nothing. As the day progressed, it became m[...]`
        },
        {
            user: "Tsunami_Surv", title: "Member", date: "Nov 12, 2004, 04:20 PM",
            text: `The emergency broadcast system turned on at 3 AM, but the message wasn't about weather. It was a voice saying that it had been hit by the largest natural disaster in the history of [...]`
        },
        {
            user: "Imaginary_Friend", title: "Senior Member", date: "Nov 15, 2004, 12:00 PM",
            text: `My daughter has an imaginary friend, but yesterday she told me it was hungry. I laughed it off until the next day, and now the thought is no longer a joke.\n\n”Her eyes lit up. ��[...]`
        },
        {
            user: "Morgue_Worker", title: "Administrator", date: "Nov 18, 2004, 02:45 AM",
            text: `I work the night shift at the morgue, and the bodies are supposed to stay still. But tonight, drawer 4B’s shelves were empty. There was nothing. As the day progressed, it became m[...]`
        },
        {
            user: "Static_Radio", title: "Junior Member", date: "Nov 22, 2004, 11:59 PM",
            text: `The GPS led me down an old dirt road that didn't exist on any map. The radio suddenly cut to static and the car stopped in a field outside of town. I found a rock at a picnic table [...]`
        },
        {
            user: "11_11_Caller", title: "Member", date: "Nov 25, 2004, 11:11 PM",
            text: `Every night at exactly 11:11, my phone rings. There is nobody on the other end, just the sound of it ringing and a long pause. Then there is silence again.\n\nI sit there, at least [...]`
        },
        {
            user: "Used_Computer", title: "Banned", date: "Dec 01, 2004, 09:00 AM",
            text: `I bought a used computer from a garage sale. I found a folder named 'The Truth', and inside was a video of me playing it. It showed a little text saying “Hello everyone.” When t[...]`
        },
        {
            user: "Camp_Happy", title: "Member", date: "Dec 05, 2004, 07:15 AM",
            text: `We went camping deep in the woods to get away from everything.\n\nWhen we woke up, the tent zipper was torn. The tent was a mess, too: our stuff was scattered everywhere, covered in[...]`
        },
        {
            user: "Itchy_Arm", title: "Junior Member", date: "Dec 08, 2004, 06:30 PM",
            text: `The itch on my left arm started a week ago.\n\nToday when I scratched it, something underneath the skin changed.\n\nIt felt like my hand was being pierced by someone else’s finger[...]`
        },
        {
            user: "Ritual_Player", title: "New Member", date: "Dec 12, 2004, 10:00 PM",
            text: `The online forum said the ritual was just a game.\n\nBut after I lit the third candle, the shadows in the corner of the room dimmed.\n\nMy father grabbed me and looked over his shou[...]`
        },
        {
            user: "Town_Smile", title: "Senior Member", date: "Dec 15, 2004, 08:00 AM",
            text: `I woke up this morning and everyone in my town was smiling.\n\nNot a happy smile, but a wide, stretched grin that looked like I’d just woken up from a deep sleep.\n\nThe air was w[...]`
        },
        {
            user: "Coat_Thrift", title: "Moderator", date: "Jan 02, 2005, 04:44 PM",
            text: `I bought a vintage coat from a thrift store, but I found a USB drive stitched into the lining. The only file on it was named “Piotr-Wyatt-20/5” with a stamp of approval attached[...]`
        },
        {
            user: "Fire_Lookout", title: "Member", date: "Jan 10, 2005, 01:20 AM",
            text: `I've been the sole fire lookout for this forest for three months, but tonight I saw a fire that wasn't burning trees.`
        },
        {
            user: "X_Ray_Specs", title: "Junior Member", date: "Jan 15, 2005, 09:15 AM",
            text: `The doctor said my X-ray was clear, but I can still feel something moving inside my ribcage. It feels like he’s squeezing and pulsating them.”`
        },
        {
            user: "Video_Chat", title: "Junior Member", date: "Dec 16, 2005, 09:02 AM",
            text: `I was video chatting with my wife when I heard the front door open behind her. I froze because I saw myself on the mirror, as if a ghost had returned and left me to face the mirror [...]`
        },
        {
            user: "My_Dog", title: "Junior Member", date: "Aug 2, 2005, 19:39 AM",
            text: `My dog has been barking at the empty corner of the room for hours. When I took a picture with the flash on, I saw it right away as the dog was barking outside the window. It wasn’[...]`
        }
    ];

    // ==========================================
    // DATA: MARKOV CORPUS & LOGIC
    // ==========================================
    const corpus = `
If you hear three knocks at the door after sunset, do not answer.
If you hear a single, hard knock, open the door, but do not look at who stands there.
Hold out a basket of freshly baked bread and wait until you hear the footsteps leaving to shut the door.
If you hear someone call your name from the woods, do not answer.
If you see a figure at the tree line wearing a wide-brimmed hat, do not look at him for longer than one second.
If you hear chains dragging on the ground, sprinkle salt on all windowsills and door thresholds within one minute.
If a candle is burning in the window of the old, abandoned Anderson cabin up the hill, stay indoors, no matter what.
If the dog barks at the empty corner, leave the room backwards.
Do not whistle at night, for the wind will whistle back with a voice that is not yours.
If the fire turns blue, a spirit is passing through the chimney; cover your mouth.
Never follow a light that moves against the wind.
If you find a comb on the trail, leave it; the owner is looking for a way in.
The trees remember the blood spilled at their roots, so do not sleep beneath the weeping willow.
If the cicadas stop buzzing all at once, something is listening to your breathing.
Don't look at the moon through a reflection in the water, or you will see the face of your death.
If a stranger offers you water in a cup made of bone, decline politely and walk west.
When the fog smells of sulfur, the gate is open.
If you hear a baby crying in the deep woods, run the other way; it is a mimic.
Do not acknowledge the shadow that stands by your bed; it feeds on attention.
If the milk sours in an hour, the Little Folk are in the pantry.
If you smell wet earth in your bedroom, do not look under the bed.
The man with the backwards hands asks for directions; point him to the graveyard.
If the birds fly into your window, the debt has come due.
If you hike where the fog clings low to the pine, And the wind through the hollow hums mournful in time, Then heed what the old ones have carved into lore, Or you won’t leave the woods like you’ve[...]
When daylight is dying, be back in your bed, For the dusk wakes the ones that remember the dead.
Don’t open for knocking, don’t answer your name, If it stands on two legs but don’t move the same.
If you hear a soft song where no singer should be, Keep walking and humming, eyes down, don’t you dare see.
Leave bread on the stump if you’ve borrowed the trail, Or the Little Ones curse you with more than just ail.
Don’t wave at the figure who waits in the field, It knows you’ve now seen it and won’t stay concealed.
Don’t speak of the thing that you glimpsed in the trees, What’s named becomes real, and it’ll find you with ease.
If silence falls sudden, then hush every breath, For the quiet in woods is the herald of death.
Three pennies at crossroads, don’t ask, just obey, Or you’ll owe a fare that you can’t ever pay.
Don’t cut at the oak with a face in the bark, Its roots run through bones buried deep in the dark.
If a man joins your fire and don’t meet your gaze, Offer food, speak no questions, and part ways with praise.
Don’t fish past the hour when the moon’s at its height, What bites past that mark drags you down out of sight.
Mark ash on your door come the coldest of nights, To ward off the shadows that dance without light.
If you wake up with dirt on the soles of your feet, Say thanks and lie down, don’t recall, don’t repeat. And pray, not the way that the preacher man said, But the tongue of your grandma, who speak[...]
If you hear three knocks at the door after sunset, do not answer.
    `;

    let markovChain = {};
    const stateSize = 2; 

    function buildChain() {
        const words = corpus.replace(/\n/g, " ").trim().split(/\s+/);
        for (let i = 0; i < words.length - stateSize; i++) {
            let key = words.slice(i, i + stateSize).join(" ");
            let nextWord = words[i + stateSize];
            if (!markovChain[key]) markovChain[key] = [];
            markovChain[key].push(nextWord);
        }
    }

    // Helper to generate a single "sentence" that ends in punctuation or hits a limit
    function generateSentence() {
        const keys = Object.keys(markovChain);
        let validStarts = keys.filter(k => /^[A-Z]/.test(k));
        if (validStarts.length === 0) validStarts = keys;

        let currentKey = validStarts[Math.floor(Math.random() * validStarts.length)];
        let result = currentKey.split(" ");
        let wordCount = 2;
        
        // Try to generate until punctuation or max 30 words
        while (wordCount < 40) {
            let possibilities = markovChain[currentKey];
            if (!possibilities || possibilities.length === 0) break;
            
            let nextWord = possibilities[Math.floor(Math.random() * possibilities.length)];
            result.push(nextWord);
            wordCount++;

            // Stop if we hit terminal punctuation
            if (/[.!?]$/.test(nextWord)) {
                break;
            }
            
            currentKey = result.slice(result.length - stateSize).join(" ");
        }
        return result.join(" ");
    }

    // ==========================================
    // VIEW CONTROLLER
    // ==========================================
    const portalView = document.getElementById('portal-view');
    const cpView = document.getElementById('creepypasta-view');
    const genView = document.getElementById('appalachian-view');
    let cpCurrentPage = 1;
    let genPostCount = 0;

    function showPortal() {
        portalView.style.display = 'flex';
        cpView.style.display = 'none';
        genView.style.display = 'none';
        
        // Ensure overlay is hidden
        const overlay = document.getElementById('screen-glitch');
        if(overlay) overlay.style.display = 'none';
    }

    function loadCreepypastaMode() {
        // Scary Transition
        triggerScreenGlitch();
        setTimeout(() => {
            portalView.style.display = 'none';
            cpView.style.display = 'flex';
            genView.style.display = 'none';
            renderCPPosts(1);
        }, 800);
    }

    function loadAppalachianMode() {
        // Scary Transition
        triggerScreenGlitch();
        setTimeout(() => {
            portalView.style.display = 'none';
            cpView.style.display = 'none';
            genView.style.display = 'flex';
            buildChain(); 
            if (genPostCount === 0) {
                generateNewMarkovPost();
            }
        }, 800);
    }

    function triggerScreenGlitch() {
        const overlay = document.getElementById('screen-glitch');
        const messages = [
            "SYSTEM FAILURE", "DON'T TURN THE PAGE", "LOOK BEHIND YOU", 
            "DATA CORRUPTED", "THEY ARE LISTENING", "FATAL ERROR", "RUN"
        ];
        
        overlay.innerText = messages[Math.floor(Math.random() * messages.length)];
        overlay.style.display = "flex";
        
        let flickerCount = 0;
        const flickerInterval = setInterval(() => {
            overlay.style.backgroundColor = flickerCount % 2 === 0 ? "#111" : "#000";
            overlay.style.color = flickerCount % 2 === 0 ? "red" : "white";
            flickerCount++;
        }, 50);

        setTimeout(() => {
            clearInterval(flickerInterval);
            overlay.style.display = "none";
        }, 800);
    }

    // ==========================================
    // RENDER LOGIC: CREEPYPASTA
    // ==========================================
    const CP_ITEMS_PER_PAGE = 3;

    // Helper: Zalgo / Corruption text generator
    function corruptText(text) {
        const chars = ['@', '#', '$', '%', '&', '?', '†', '‡', 'ERROR', 'NULL', '666'];
        return text.split('').map(char => {
            return Math.random() < 0.15 ? chars[Math.floor(Math.random() * chars.length)] : char;
        }).join('');
    }

    function renderCPPosts(page) {
        cpCurrentPage = page;
        const container = document.getElementById('cp-posts-container');
        container.innerHTML = "";
        
        const totalPages = Math.ceil(cpStories.length / CP_ITEMS_PER_PAGE);
        const startIndex = (page - 1) * CP_ITEMS_PER_PAGE;
        const pageStories = cpStories.slice(startIndex, startIndex + CP_ITEMS_PER_PAGE);
        
        document.getElementById('cp-page-indicator').innerText = `Page ${page} of ${totalPages}`;

        pageStories.forEach((story, index) => {
            const globalIndex = startIndex + index + 1;
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            
            // --- Random Scary Logic ---
            const isCursed = Math.random() < 0.15;
            const isGlitchAvatar = Math.random() < 0.2;

            const userClass = isCursed ? "username cursed-text" : "username";
            const avatarClass = isGlitchAvatar ? "avatar avatar-glitch" : "avatar";
            const displayUser = isCursed ? corruptText(story.user) : story.user;
            const avatarContent = isGlitchAvatar ? "NO_SIGNAL" : "IMG_" + globalIndex;
            
            postDiv.innerHTML = `
                <div class="user-sidebar">
                    <div class="${userClass}">${displayUser}</div>
                    <div class="user-title">${story.title}</div>
                    <div class="${avatarClass}">${avatarContent}</div>
                    <div style="margin-top:10px;">${isCursed ? "<span style='color:red; font-weight:bold;'>[WATCHING YOU]</span>" : "<span style='color:#0f0'>[ONLINE]</span>"}</div>
                    <br>Posts: ???
                </div>
                <div class="post-content">
                    <div class="post-header"><span>${story.date}</span><span>#${globalIndex}</span></div>
                    <div class="post-body">${story.text.replace(/\n/g, '<br>')}</div>
                    <div class="post-footer">"Sleep well."</div>
                </div>
            `;
            container.appendChild(postDiv);
        });

        // Pagination Controls
        const nav = document.getElementById('cp-pagination');
        let html = '';
        if (page > 1) html += `<button class="page-btn" onclick="renderCPPosts(${page - 1})">[ << Prev ]</button>`;
        if (page < totalPages) html += `<button class="page-btn" onclick="renderCPPosts(${page + 1})">[ Next >> ]</button>`;
        nav.innerHTML = html;
        
        window.scrollTo(0,0);
    }

    // ==========================================
    // RENDER LOGIC: GENERATOR
    // ==========================================
    const cursedUsers = [
        { name: "The_Woods", title: "Administrator", avatar: "NO_SIGNAL", color: "red" },
        { name: "Unknown_Signal", title: "Banned", avatar: "ERR_404", color: "#888" },
        { name: "Cabin_Dweller", title: "Junior Member", avatar: "LOGS", color: "brown" },
        { name: "Echo_Location", title: "Member", avatar: "WAVE", color: "teal" }
    ];

    const spookySignatures = [
        "I grew up in the Appalachian mountains and I know all of the rules.",
        "I grew up in those mountains.",
        "I belong to the mountains.",
        "I have been living in the mountains since 1802.",
        "They are listening to us now.",
        "I am not the one who left.",
        "The soil remembers my name.",
        "Get me out of here.",
        "I shouldn't have come here.",
        "I miss you.",
        "Let me tell you what I saw in the Appalachian Mountains.",
        "COME VISIT THE APPALACHIAN MOUNTAINS!",
        "Hi, I love hiking!",
        "Love nature",
        "Tell us about yourself!",
        "Are you real?",
        "Who am I?",
        "Who are you?",
        "I have a cat and a big box. Come play with us!"
    ];

    function generateNewMarkovPost() {
        genPostCount++;
        document.getElementById('gen-post-count').innerText = `Posts: ${genPostCount}`;

        // Generate 1 to 3 distinct sentences/warnings
        let warningsCount = Math.floor(Math.random() * 3) + 1; 
        let fullText = "";
        
        for(let i=0; i<warningsCount; i++) {
            fullText += generateSentence() + "<br><br>";
        }

        const user = cursedUsers[Math.floor(Math.random() * cursedUsers.length)];
        const signature = spookySignatures[Math.floor(Math.random() * spookySignatures.length)];
        const dateStr = new Date().toLocaleTimeString();

        const container = document.getElementById('gen-posts-container');
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        
        const nameClass = Math.random() > 0.7 ? "username cursed-text" : "username";
        
        postDiv.innerHTML = `
            <div class="user-sidebar">
                <div class="${nameClass}" style="color:${user.color}">${user.name}</div>
                <div class="user-title">${user.title}</div>
                <div class="avatar" style="border-color:${user.color}; color:${user.color};">${user.avatar}</div>
                <br>Posts: ???
            </div>
            <div class="post-content">
                <div class="post-header"><span>TODAY, ${dateStr}</span><span>#${genPostCount}</span></div>
                <div class="post-body" style="font-family:'Courier New'; text-shadow:0 0 2px red;">${fullText}</div>
                <div class="post-footer">"${signature}"</div>
            </div>
        `;

        container.appendChild(postDiv);
        postDiv.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Init
    window.onload = function() {
        showPortal(); // Start at root
        
        // --- Cursed Title Hover Effect ---
        const titleElement = document.getElementById('thread-title');
        const originalTitle = 'Thread: "Found these text files on an old hard drive..."';
        // Fix: use a short, safe string (no unclosed template literal)
        const cursedTitle = 'Thread: "Something is watching..."';

        if(titleElement) {
            titleElement.addEventListener('mouseenter', () => {
                titleElement.innerText = cursedTitle;
                titleElement.style.color = 'red';
                titleElement.style.cursor = 'help';
            });

            titleElement.addEventListener('mouseleave', () => {
                titleElement.innerText = originalTitle;
                titleElement.style.color = 'white';
            });
        }
    }

</script>
</body>
</html>
